# Упражнение: Усовершенствование компактной схемы для уравнения диффузии с внешними силами

# Обзор

Это упражнение предполагает модификацию скрипта MATLAB, реализующего компактную схему решения уравнения диффузии. Задача состоит в том, чтобы включить внешнюю силу, сравнить численное решение с истинным решением и проанализировать точность для различных размеров сетки.

## Цели

1. **Учесть внешнюю силу**: Усовершенствовать код MATLAB для учета внешней силы $f(t, x)$.
2. **Истинное решение и определение силы**: Определите истинное (опорное) решение $u_{\text{true}}(t, x) = \sin(t) \cdot \cos(x)$ и выведите соответствующую силу $f(t, x)$.
3. **Сравнение решений**: Сравните решение, полученное численным методом, с истинным решением.
4. **Анализ размера сетки**: Проанализируйте решения для нескольких размеров сетки, сохраняя параметр Куранта $\nu = \frac{D \tau}{h}$ фиксированным. Постройте графики $C$ и $L_2$ нормы разности между полученным и истинным решениями.

## Раздел 1: Включение внешней силы

Измените предоставленный код MATLAB, чтобы включить член внешней силы в уравнение диффузии. Функция силы $f(t, x)$ должна быть определена и интегрирована в численную схему.

### Задача 1.1: Определить внешнюю силу

Определите новую функцию для внешней силы $f(t, x)$. Эта функция должна иметь возможность принимать в качестве входных данных время $t$ и пространственную координату $x$.

**Фрагмент кода**:

```matlab
function f_val = external_force(t, x)
    % Define the external force function here
    f_val = ...; % Replace with the actual function
end
```

### Задача 1.2: Обновление численной схемы

Интегрируйте внешнюю силу в численную схему. Убедитесь, что член силы соответствующим образом добавлен к шагу обновления схемы.

**Модификация кода**:

```matlab
% Inside the integration loop
for k = 2 : Nt
    % Calculate the force term for the current time step
    % Note: you might need to do that for several time steps
    % depending on the number of temporal layers of the scheme
    f_term = external_force((k-1)*tau, x(1:end-1));
    % Update U(k, :) to include the force term
    U(k, :) = -U_next \ (U_now * U(k - 1, :).' + f_term);
end
```

## Раздел 2: Истинное решение и определение силы

### Задача 2.1: Определите истинное решение

Определите истинное решение $u_{\text{true}}(t, x) = \sin(t) \cdot \cos(x)$.

**Фрагмент кода**:

```matlab
function u_true_val = u_true(t, x)
    u_true_val = sin(t) .* cos(x);
end
```

### Задача 2.2: Определите соответствующую силу

Выведите формулу для силы $f(t, x)$, которая соответствует заданному истинному решению. Приведите вывод в отчете и реализуйте функцию в MATLAB.

## Раздел 3: Сравнение решений

Сравните численное решение с истинным решением на различных временных шагах. Постройте графики решений для визуального сравнения.

### Задание 3.1: Сравнение на определенных временных шагах

**Фрагмент кода**:

```matlab
% Comparison loop
for k = [selected time steps]
    % Calculate true solution
    u_true_k = u_true((k-1)*tau, x);
    % Plot numerical and true solutions
    figure;
    plot(x, U(k, :), 'r', x, u_true_k, 'b--');
    legend('Numerical Solution', 'True Solution');
    title(['t = ', num2str((k-1)*tau)]);
end
```

## Раздел 4: Анализ размера сетки

Проанализируйте точность численного решения для различных размеров сетки. Сохраняйте параметр Куранта $\nu$ фиксированным и стройте графики разностей $C$ и $L_2$.

### Задача 4.1: Проведите анализ для различных размеров сетки

**Фрагмент кода**:

```matlab
% Define different grid sizes
grid_sizes = [50, 100, 200, 400, ...];

% Loop over grid sizes
for Nx = grid_sizes
    % Update other parameters based on Nx
    % ...
    % Perform the simulation
    % ...
    % Calculate and plot C and L2 norms
    % ...
end
```

### Задание 4.2: Построение графиков норм

Постройте графики норм $C$ и $L_2$ для каждого размера сетки. При необходимости используйте логарифмическое масштабирование для лучшей визуализации результатов.
